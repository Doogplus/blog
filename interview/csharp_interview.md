# C# 面试题

## 基础篇


### 问：堆，栈的区别，栈中栈帧是用来干嘛的？（C#图解这本书79页）

栈：用于保存局部变量，程序当前执行环境，传递给方法的参数等。
堆：分配对象内存，大对象等。
栈帧：栈上的分配单元，有以下特征：
 1. 保存内容：返回地址，参数分配的内存，各种和方法调用相关的其他管理数据项
 2. 在方法调用时，整个栈帧都会压入栈
 3. 在方法退出的时候，整个栈帧都会从栈上弹出（unwind）。


### 一个类是否可以不显示声明构造函数（默认生成无参的），如果显示声明了一个带参的，那这个类有几个构造函数？（C#图解102页）

默认构造函数特征：
1. 没有参数
2. 方法体为空

若显示定义了至少一个构造函数，则编译器不会创建任何额外的构造函数。


### 访问成员修饰符（C#图解137页）

                        同一程序集内的类    不同程序集内的类
                        非派生    派生      非派生    派生
    private
    internal               1       1
    protected                      1                  1
    protected internal     1       1                  1
    public                 1       1          1       1


### do..while 和 while 区别  

前者先执行一次


### foreach里怎么得到的当前索引

```C#
int i = 0;
foreach (var item in arr)
{
    i++;
    item...
}

// better
foreach (var item in arr)
{
    int index = arr.indexOf(item); //只适合可以用这种方法获取索引的
    item...
}
```


## 提高篇

### new一个1G的对象在垃圾回收的第几代  CLR459页

C#虚拟机拥有大对象概念，比如大于85000字节（书中）就属于大对象。关于大对象有以下几种特别对待方式
 1. 大对象不是在小对象的地址空间分配，而是在进程地址空间的其他地方分配
 2. 目前版本的GC不压缩大对象，因为在内存中移动它们的代价过高。但这可能在进程中的大对象之间造成地址空间的碎片化，以至于抛出OutOfMemoryException。CLR将来的版本可能压缩大对象。
 3. 大对象总是第二代，绝不可能是第0代或者第1代。所以只能为需要长时间存活的资源创建大对象。分配短时间存活的大对象会导致第2代被更频繁的回收，会损害性能。大对象一般是大字符串（比如XML或Json）或者用于I/O操作的字节数组（比如从文件或网络将字节读入缓冲区以便处理）


### 线程的概念，CPU调度线程做了哪些事情？上下文切换耗费资源，为什么不单核运行一个线程（可响应性和性能）CLR592页

线程组成：线程内核对象（thread kernel object），线程环境块（thread environment block),用户模式栈（user-mode stack），内核模式栈（kernel-mode stack),DLL线程链接(attach)和线程分离（detach）通知。

每次上下文切换：
 1. 将CPU寄存器的值保存到当前正在运行的线程的内核对象内部的一个上下文结构中。
 2. 从现有的线程集合中选出一个线程供调度。如果该线程由另一个进程拥有，Windows在开始执行任何代码或者接触任何数据之前，还必须切换CPU“看见”的虚拟地址空间。
 3. 将所选上下文结构中的值加载到CPU的寄存器中。


### 静态类特点？静态类有基类吗？是啥 CLR141页

 1. 静态类必须直接从基类System.Object派生，从其他任何基类派生都没有意义。继承只适用于对象，而你不能创建静态类的实例。
 2. 静态类不能实现任何接口，只是因为只有使用类的实例时，才可调用类的接口方法。
 3. 静态类只能定义静态成员（字段、方法、属性和事件），任何实例成员都会导致编译器的报错。
 4. 静态类不能作为字段、方法参数或局部变量使用，因为它们都代表引用了实例的变量，而这是不允许的。编译器检测到任何这样的用法都会报错。


### 常量是干吗的？基本类型常量和引用类型常量都有吗？有区别吗？ CLR 155页

常量是值从不变化的符号。定义常量符号时，他的值必须能在编译时确定。确定后，编译器将常量值保存到程序集元数据中。这意味着只能定义编译器识别的基元类型的常量。在C#中，一下类型是基元类型，可用于定义常量：Boolean, Char, Byte, SByte, Int16, UInt16, Int32, UInt32, Int64, UInt64, Single, Double, Decimal 和 String。然而，C#也允许定义非基元类型的常量变量（constant variable),前提是把值设置为null。C#不允许为常量指定static关键字。


### Object类方法，Equals Finalize GetHashCode ToString，GetHashCode方法的值作为key存入数据库可行吗？谈谈ToString方法的理解

 1. getClass 返回当前运行时对象的Class对象
 2. hashCode 返回该对象的hash码
 3. equals 比较对象是否相等
 4. clone 拷贝对象
 5. toString 默认实现为getClass().getName() + "@" + Integer.toHexString(hashCode());一般重写为描述当前对象的简单字符串
 6. notify 与wait相对，唤起监听线程
 7. notifyAll 唤起所有监听线程
 8. wait 获取当前对象锁
 9. finalize 垃圾回收前调用

GetHashCode的值是实时生成的，会随着对象的任何变动而改变，两个对象相同，其hash值一定相同。


## 碾压篇

TODO
